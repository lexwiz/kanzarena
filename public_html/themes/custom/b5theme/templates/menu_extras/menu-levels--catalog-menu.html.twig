{#
/**
 * @file
 * Default theme implementation to each level of menu.
 */
#}
{#{% import _self as menu %}#}

{#{{ menu.menu_links(items, attributes, 0) }}#}

{#{% macro menu_links(items, attributes, menu_level) %}#}
{#  {% if menu_level == 0 %}#}
{#  <ul{{ attributes.addClass('navbar-nav mr-auto') }}>#}
{#    <ul class="navbar-nav mr-auto menu-level-{{ items|first.menu_level }}">#}
{#  {% else %}#}
{#  <ul class="dropdown-menu">#}
{#    <ul class="dropdown-menu menu-level-{{ items|first.menu_level }}">#}
{#  {% endif %}#}
{#  {% for key, item in items if key|first != '#' %}#}
{#    {% set menu_item_classes = [#}
{#      'nav-item',#}
{#      'nav-link',#}
{#      item.is_expanded ? 'menu-item--expanded',#}
{#      item.is_collapsed ? 'menu-item--collapsed',#}
{#      item.in_active_trail ? 'menu-item--active-trail',#}
{#    ] %}#}

{#    <li{{ item.attributes.addClass(menu_item_classes) }}>#}
{#      {{ link(item.title, item.url) }}#}
{#      {% set rendered_content = item.content|without('') %}#}
{#      {% if rendered_content|render %}#}
{#        {{ rendered_content }}#}
{#      {% endif %}#}
{#    </li>#}
{#  {% endfor %}#}
{#  </ul>#}
{#{% endmacro %}#}

{% import _self as menus %}

{#
We call a macro which calls itself to render the full tree.
@see http://twig.sensiolabs.org/doc/tags/macro.html
#}
{{ menus.build_menu(items, attributes, 0) }}

{% macro build_menu(items, attributes, menu_level) %}
  {% import _self as menus %}
  {% if items %}
    {% if menu_level == 0 %}
<ul{{ attributes.addClass('navbar-nav mr-auto') }}>
  {% else %}
  <ul class="dropdown-menu">
    {% endif %}
    {% for item in items %}
      {{ menus.add_link(item, attributes, menu_level) }}
    {% endfor %}
  </ul>
  {% endif %}
  {% endmacro %}

  {% macro add_link(item, attributes, menu_level) %}
    {% import _self as menus %}
    {%
      set list_item_classes = [
      'nav-item',
      item.is_expanded ? 'dropdown'
    ]
    %}
    {%
      set link_class = [
      menu_level == 0 ? 'nav-item',
      menu_level == 0 ? 'nav-link',
      item.in_active_trail ? 'active',
      menu_level == 0 and (item.is_expanded or item.is_collapsed) ? 'dropdown-toggle',
      menu_level > 0 ? 'dropdown-item',
    ]
    %}
    {%
      set toggle_class = [
    ]
    %}
    <li{{ item.attributes.addClass(list_item_classes) }}>
      {% if menu_level == 0 and item.below %}
        {{ link(item.title, item.url, { 'class': link_class, 'role': 'button', 'data-bs-toggle': 'dropdown', 'aria-expanded': 'false', 'title': ('Expand menu' | t) ~ ' ' ~ item.title }) }}
        {{ menus.build_menu(item.below, attributes, menu_level + 1) }}
      {% else %}
        {{ link(item.title, item.url, { 'class': link_class }) }}
        {% set rendered_content = item.content|without('') %}
        {% if rendered_content|render %}
          {{ rendered_content }}
        {% endif %}
      {% endif %}
    </li>
  {% endmacro %}
